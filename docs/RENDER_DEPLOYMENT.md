# Render Deployment Guide for Vigia

This guide explains how to deploy Vigia to Render for production use.

## üöÄ Quick Deploy

### Option 1: Deploy with Render Blueprint (Recommended)

1. Fork the repository to your GitHub account
2. Click the button below:

[![Deploy to Render](https://render.com/images/deploy-to-render-button.svg)](https://render.com/deploy?repo=https://github.com/AutonomosCdM/vigia)

3. Fill in the required environment variables
4. Click "Create Resources"

### Option 2: Manual Deploy

1. **Create a Render account** at https://render.com

2. **Connect your GitHub account**

3. **Create services manually**:

## üì¶ Services to Deploy

### 1. WhatsApp Bot (Web Service)

- **Name**: `vigia-whatsapp`
- **Environment**: Python 3
- **Build Command**: `pip install -r requirements.txt`
- **Start Command**: `python render_whatsapp.py`
- **Health Check Path**: `/health`

### 2. Webhook API (Web Service)

- **Name**: `vigia-webhook`
- **Environment**: Python 3
- **Build Command**: `pip install -r requirements.txt`
- **Start Command**: `python render_webhook.py`
- **Health Check Path**: `/health`

### 3. Redis Cache (Redis Service)

- **Name**: `vigia-redis`
- **Plan**: Starter (Free - 25MB)
- **Eviction Policy**: allkeys-lru

## üîê Environment Variables

### Required for WhatsApp Service:

```bash
TWILIO_ACCOUNT_SID=your-twilio-sid
TWILIO_AUTH_TOKEN=your-twilio-token
TWILIO_WHATSAPP_FROM=whatsapp:+your-number
ANTHROPIC_API_KEY=your-anthropic-key
SUPABASE_URL=your-supabase-url
SUPABASE_KEY=your-supabase-key
REDIS_URL=<auto-filled from Redis service>
RATE_LIMIT_ENABLED=true
RATE_LIMIT_PER_MINUTE=30
```

### Required for Webhook Service:

```bash
WEBHOOK_SECRET=<auto-generated>
ANTHROPIC_API_KEY=your-anthropic-key
SUPABASE_URL=your-supabase-url
SUPABASE_KEY=your-supabase-key
REDIS_URL=<auto-filled from Redis service>
```

## üîÑ Post-Deployment Steps

### 1. Configure Twilio Webhook

1. Get your Render service URL:
   - Format: `https://vigia-whatsapp.onrender.com`

2. Go to Twilio Console > WhatsApp Sandbox

3. Set webhook URL:
   ```
   https://vigia-whatsapp.onrender.com/webhook/whatsapp
   ```

### 2. Test the Deployment

1. Send a test message to your WhatsApp number
2. Check Render logs for activity
3. Verify Redis is caching properly

### 3. Set up Monitoring

1. Enable Render's built-in monitoring
2. Set up alerts for service health
3. Configure auto-scaling if needed

## üìä Render Dashboard URLs

After deployment, access your services at:

- WhatsApp Bot: `https://vigia-whatsapp.onrender.com`
- Webhook API: `https://vigia-webhook.onrender.com`
- Dashboard: `https://dashboard.render.com`

## üö® Troubleshooting

### Service won't start
- Check logs in Render dashboard
- Verify all environment variables are set
- Ensure Python version is 3.11+

### WhatsApp not receiving messages
- Verify Twilio webhook URL is correct
- Check Twilio logs for errors
- Ensure service is running (green status)

### Redis connection errors
- Verify REDIS_URL is set correctly
- Check Redis service is running
- Ensure services are in same region

## üí∞ Pricing

### Free Tier Includes:
- 750 hours/month of service runtime
- 100GB bandwidth
- Redis Starter (25MB)

### Estimated Monthly Cost:
- **Free tier**: $0 (with limitations)
- **Starter**: ~$7/service/month
- **Professional**: ~$25/service/month

## üîÑ CI/CD Setup

Render automatically deploys on:
- Push to main branch
- Manual deploy trigger
- API deploy webhook

To disable auto-deploy:
1. Go to Service Settings
2. Toggle "Auto-Deploy" off
3. Deploy manually when ready

## üìà Scaling

### Horizontal Scaling
- Increase instances in service settings
- Load balancing handled automatically

### Vertical Scaling
- Upgrade service plan
- More CPU/RAM allocated

### Redis Scaling
- Upgrade from Starter to Standard
- More memory and persistence

## üîí Security

1. **Use environment variables** for all secrets
2. **Enable HTTPS** (automatic on Render)
3. **Set up IP allowlists** if needed
4. **Regular security updates** via auto-deploy

## üìû Support

- Render Docs: https://render.com/docs
- Render Community: https://community.render.com
- Vigia Issues: https://github.com/AutonomosCdM/vigia/issues